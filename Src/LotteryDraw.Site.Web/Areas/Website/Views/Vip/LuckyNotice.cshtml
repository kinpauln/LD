@{
    ViewBag.Title = "LuckyNotice";
    Layout = "~/Areas/Website/Views/Shared/_Layout_Vip.cshtml";
}

@using Webdiyer.WebControls.Mvc
@using LotteryDraw.Component.Tools
@model PagedList<LotteryDraw.Site.Models.LotteryResultView>

@section  LeftMenuItems{
    @Html.Partial("VipNavPartial")
}

@section  BreadCrumbs{
    &gt;
    <label>中奖通知</label>
}

@section styles{
    <link href="~/Content/website/css/prize.css" rel="stylesheet" />
}
<div class="active" id="prizelist" style="margin: 10px 0;">

    @if (!string.IsNullOrEmpty(TempData["Message"] as string))
    {
        <div style="color: #f00;" class="error-info">@TempData["Message"]</div>
    }
    <table class="prize-list">
        <tr>
            <th>奖品名称</th>
            <th>状态</th>
            <th style="width: 120px;">操作</th>
        </tr>
        @if (Model == null || Model.Count == 0)
        {
            <tr>
                <td colspan="6">没有中奖信息</td>
            </tr>
        }
        @foreach (var item in Model)
        {
            string photoName = string.Empty;
            //if (item.PrizeOrderView != null && item.PrizeOrderView.PrizeView != null)
            //{
            //    if (item.PrizeOrderView.PrizeView.OriginalPhoto != null && !string.IsNullOrEmpty(item.PrizeOrderView.PrizeView.OriginalPhoto.Name))
            //    {
            //        photoName = "/Files/PrizePhotos/" + item.MemberView.Id + "/" + item.PrizeOrderView.PrizeView.OriginalPhoto.Name;
            //    }
            //}
            <tr>
                <td>
                    <div title="@item.PrizeOrderView.PrizeView.Name" style="text-align:left;width:400px;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;overflow: hidden;">@item.PrizeOrderView.PrizeView.Name</div>
                </td>
                <td>@item.LotteryResultState.ToDescription()</td>
                <td><a href="/Vip/PrizeDetail/@item.PrizeOrderView.PrizeView.Id">详情</a>&nbsp;|&nbsp; 
                    @{
            if (item.LotteryResultState == LotteryResultState.Default)
            {
                        <a href="#" class="Paid" ltid ="@item.Id">我已付款</a>
            }
            else if (item.LotteryResultState == LotteryResultState.Posting)
            {
                        <a href="#" class="Received" ltid ="@item.Id">我已收货</a>
            }
                    }
                </td>
            </tr>
        }
    </table>
    @Html.Pager(Model, new PagerOptions
{
    PageIndexParameterName = "id",
    FirstPageText = "首页",
    LastPageText = "尾页",
    PrevPageText = "上一页",
    NextPageText = "下一页",
    PagerItemsSeperator = "",
    CurrentPagerItemWrapperFormatString = "<span class=\"current\">{0}</span>"
}, new { @class = "diggpager" })
</div>
@section scripts{
    <script type="text/javascript">
        $(function () {
            $("a[class*='Received']").click(function (e) {

                e.preventDefault();
            });

            $("a[class*='Paid']").click(function (e) {
                var ltid = $(this).attr("ltid");
                var loadi;
                $.ajax({
                    type: "post",
                    data: { id: ltid, state: '@LotteryResultState.Paid.ToInt()' },
                    url: "/Vip/UpdateLotteryResult",
                    beforeSend: function () {
                        loadi = layer.load('正在更新您的中奖状态，请耐心等待…');
                    },
                    dataType: "json",
                    success: function (data) {
                        var result = data.OK;
                        var message = data.Message;
                        if (!result) {
                            layer.alert(message, 8);
                            return;
                        }
                        layer.alert(message, 9);
                    },
                    error: function () {

                    },
                    complete: function () {
                        layer.close(loadi);
                    }
                });
                e.preventDefault();
            });
        });
    </script>
}
