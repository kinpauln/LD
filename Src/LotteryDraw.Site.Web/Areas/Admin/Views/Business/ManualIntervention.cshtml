@using Webdiyer.WebControls.Mvc;
@using LotteryDraw.Site.Models;
@using LotteryDraw.Component.Tools;
@*@model IEnumerable<LotteryDraw.Site.Models.PrizeOrderDetailView>*@
@model Webdiyer.WebControls.Mvc.PagedList<LotteryDraw.Site.Models.PrizeOrderDetailView>
@{
    ViewBag.Title = "ManualIntervention";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@section Breadcrumb{
    <li>
        <a href="#">配置管理</a>
    </li>
    <li class="active">人工干预</li>
}
@section BodyHeader{
    <h1>配置管理
								<small>
                                    <i class="icon-double-angle-right"></i>
                                    人工干预
                                </small>
    </h1>
}
@section styles{
    <link rel="stylesheet" href="~/Content/admin/assets/css/chosen.css" />
    @*<link rel="stylesheet" href="~/Content/admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="~/Content/admin/assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="~/Content/admin/assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="~/Content/admin/assets/css/colorpicker.css" />*@
    <link href="~/Content/Pager.css" rel="stylesheet" />
}
<div class="hr hr-18 dotted hr-double"></div>
<h4 class="pink">
    <i class="icon-hand-right icon-animated-hand-pointer blue"></i>
    <a href="#modal-table" role="button" class="green" data-toggle="modal">Table Inside a Modal Box </a>
</h4>
<div class="hr hr-18 dotted hr-double"></div>
<div class="hr hr-18 dotted hr-double"></div>
<h4 class="pink">
    <i class="icon-hand-right icon-animated-hand-pointer blue"></i>
    <a href="#modal-form" role="button" class="blue" data-toggle="modal">Form Inside a Modal Box </a>
</h4>
<div class="hr hr-18 dotted hr-double"></div>
<div class="row">
    <div class="col-xs-12">
        <h3 class="header smaller lighter blue">待开奖的奖单</h3>
        <div id="loadingDiv" style="display: none;">
            <img src="~/Content/admin/assets/css/images/loading.gif" /><h3>正在加载数据，请稍候...</h3>
        </div>
        <div class="table-header">
            Results for "Latest Registered Domains"
        </div>
        <div class="table-responsive">
            <div id="sample-table-2_wrapper" class="dataTables_wrapper" role="grid">
                <div class="row">
                    <div class="col-sm-6">
                        <div id="sample-table-2_length" class="dataTables_length">
                            <label>
                                显示前
                                <select size="1" name="sample-table-2_length" aria-controls="sample-table-2">
                                    <option value="10" selected="selected">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                条</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="dataTables_filter" id="sample-table-2_filter">
                            <label>
                                @using (Html.BeginForm("Search", "Business", new RouteValueDictionary { { "id", "" } }, FormMethod.Get))
                                {
                                
                                    <span>搜索关键字:</span><input type="text" name="kword" aria-controls="sample-table-2" value="@Request.QueryString["kword"]" style="width:120px"/><input type="submit" value="搜索(S)" accesskey="S" />
                                }
                            </label>
                        </div>
                    </div>
                </div>
                @{
                    if (Model == null)
                    {
                    <table class="table table-striped table-bordered table-hover dataTable" aria-describedby="sample-table-2_info">
                        <tr>
                            <td>没有符合条件的记录</td>
                        </tr>
                    </table>
                    }
                    else
                    {
                    <table id="sample-table-2" class="table table-striped table-bordered table-hover dataTable" aria-describedby="sample-table-2_info">
                        <thead>
                            <tr role="row">
                                @*<th class="center sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="style="width: 49px;">
                                <label>
                                    <input type="checkbox" class="ace">
                                    <span class="lbl"></span>
                                </label>
                            </th>*@
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Domain: activate to sort column ascending" style="width: 112px;">开奖类型</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 112px;">开奖状态</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 112px;">奖品名称</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 112px;">奖品描述</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 112px;">用户名</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 112px;">发布者</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 180px;"><i class="icon-time bigger-110 hidden-480"></i>发布日期</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 80px;">排序</th>
                                <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 80px;">操作</th>
                                <th class="sorting_disabled" role="columnheader" rowspan="1" colspan="1" aria-label="" style="width: 120px;"></th>
                            </tr>
                        </thead>


                        <tbody role="alert" aria-live="polite" aria-relevant="all">
                            @{
                        bool isOdd = true;
                        foreach (PrizeOrderDetailView item in Model)
                        {
                            string classString = "odd";
                            if (!isOdd)
                            {
                                classString = "even";
                            }
                                <tr class="@classString">
                                    @*<td class="center  sorting_1">
                                    <label>
                                        <input type="checkbox" class="ace">
                                        <span class="lbl"></span>
                                    </label>
                                </td>*@

                                    <td class=" ">@item.PrizeOrderView.RevealType.ToDescription()
                                    </td>
                                    <td class=" ">@item.PrizeOrderView.RevealState.ToDescription()</td>
                                    <td class=" ">
                                        <div title="@item.PrizeView.Name" style="width:120px;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;overflow: hidden;">@item.PrizeView.Name</div>
                                    </td>
                                    <td class=" ">
                                        <div title="@item.PrizeView.Description" style="width:120px;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;overflow: hidden;">@item.PrizeView.Description</div>
                                    </td>
                                    <td class=" ">@item.MemberView.UserName</td>
                                    <td class=" ">@item.MemberView.Name</td>
                                    <td class=" ">@item.PrizeOrderView.AddDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                    <td class=" ">@item.PrizeOrderView.SortOrder</td>
                                    <td class=" ">
                                        @*<button class="btn bootbox-regular" >干预</button>*@
                                        <a href="#modal-form" data-toggle="modal" class="intervention">干预</a>
                                    </td>
                                    <td class=" ">
                                        <div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
                                            <a class="blue" href="#">
                                                <i class="icon-zoom-in bigger-130"></i>
                                            </a>

                                            <a class="green" href="#">
                                                <i class="icon-pencil bigger-130"></i>
                                            </a>

                                            <a class="red" href="#">
                                                <i class="icon-trash bigger-130"></i>
                                            </a>
                                        </div>

                                        <div class="visible-xs visible-sm hidden-md hidden-lg">
                                            <div class="inline position-relative">
                                                <button class="btn btn-minier btn-yellow dropdown-toggle" data-toggle="dropdown">
                                                    <i class="icon-caret-down icon-only bigger-120"></i>
                                                </button>

                                                <ul class="dropdown-menu dropdown-only-icon dropdown-yellow pull-right dropdown-caret dropdown-close">
                                                    <li>
                                                        <a href="#" class="tooltip-info" data-rel="tooltip" title="" data-original-title="View">
                                                            <span class="blue">
                                                                <i class="icon-zoom-in bigger-120"></i>
                                                            </span>
                                                        </a>
                                                    </li>

                                                    <li>
                                                        <a href="#" class="tooltip-success" data-rel="tooltip" title="" data-original-title="Edit">
                                                            <span class="green">
                                                                <i class="icon-edit bigger-120"></i>
                                                            </span>
                                                        </a>
                                                    </li>

                                                    <li>
                                                        <a href="#" class="tooltip-error" data-rel="tooltip" title="" data-original-title="Delete">
                                                            <span class="red">
                                                                <i class="icon-trash bigger-120"></i>
                                                            </span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            isOdd = !isOdd;
                        }
                            }
                        </tbody>
                    </table>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="dataTables_info" id="sample-table-2_info">共 @ViewBag.PageCount 页 @ViewBag.TotalCount 条记录，当前为第 @ViewBag.PageIndex 页</div>
                        </div>
                        <div class="col-sm-6">

                            <div class="dataTables_paginate paging_bootstrap">
                                @*@Ajax.Pager(Model, new PagerOptions
       {
           PageIndexParameterName = "PrizeOrderId",
           ContainerTagName = "ul",
           FirstPageText = "首页",
           LastPageText = "尾页",
           PrevPageText = "<<",
           NextPageText = ">>",
           PagerItemsSeperator = "",
           NumericPagerItemCount = 5, //获取或设置每页显示的数字页索引索引分页导航元素的数目
           PagerItemWrapperFormatString = "<li>{0}</li>",
           CurrentPagerItemWrapperFormatString = "<li class=\"active\"><a href=\"#\">{0}</a></li>"
       },
                           new MvcAjaxOptions
                           {
                               UpdateTargetId = "sample-table-2_wrapper",
                               LoadingElementId = "loadingDiv",
                               OnBegin = "$('#sample-table-2_wrapper').fadeOut('slow')",
                               OnComplete = "$('#sample-table-2_wrapper').fadeIn('slow')",
                               EnablePartialLoading = true
                           }, new { @class = "pagination" })
        </div>*@

                                @Ajax.Pager(Model, new PagerOptions
       {
           PageIndexParameterName = "Id",
           ShowPageIndexBox = true,
           NumericPagerItemCount = 5, //获取或设置每页显示的数字页索引索引分页导航元素的数目
           PageIndexBoxType = PageIndexBoxType.DropDownList,
           ShowGoButton = false
       },
    new MvcAjaxOptions
    {
        UpdateTargetId = "sample-table-2_wrapper",
        EnablePartialLoading = true
        //,LoadingElementId = "loadingDiv",
        //OnBegin = "$('#sample-table-2_wrapper').fadeOut('slow')",
        //OnComplete = "$('#sample-table-2_wrapper').fadeIn('slow')"
    })
                            </div>
                        </div>
                    </div>}
                }
            </div>
        </div>
    </div>
</div>

<div id="modal-table" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header no-padding">
                <div class="table-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        <span class="white">&times;</span>
                    </button>
                    Results for "Latest Registered Domains
                </div>
            </div>

            <div class="modal-body no-padding">
                <table class="table table-striped table-bordered table-hover no-margin-bottom no-border-top">
                    <thead>
                        <tr>
                            <th>Domain</th>
                            <th>Price</th>
                            <th>Clicks</th>

                            <th>
                                <i class="icon-time bigger-110"></i>
                                Update
                            </th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr>
                            <td>
                                <a href="#">ace.com</a>
                            </td>
                            <td>$45</td>
                            <td>3,330</td>
                            <td>Feb 12</td>
                        </tr>

                        <tr>
                            <td>
                                <a href="#">base.com</a>
                            </td>
                            <td>$35</td>
                            <td>2,595</td>
                            <td>Feb 18</td>
                        </tr>

                        <tr>
                            <td>
                                <a href="#">max.com</a>
                            </td>
                            <td>$60</td>
                            <td>4,400</td>
                            <td>Mar 11</td>
                        </tr>

                        <tr>
                            <td>
                                <a href="#">best.com</a>
                            </td>
                            <td>$75</td>
                            <td>6,500</td>
                            <td>Apr 03</td>
                        </tr>

                        <tr>
                            <td>
                                <a href="#">pro.com</a>
                            </td>
                            <td>$55</td>
                            <td>4,250</td>
                            <td>Jan 21</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="modal-footer no-margin-top">
                <button class="btn btn-sm btn-danger pull-left" data-dismiss="modal">
                    <i class="icon-remove"></i>
                    Close
                </button>

                <ul class="pagination pull-right no-margin">
                    <li class="prev disabled">
                        <a href="#">
                            <i class="icon-double-angle-left"></i>
                        </a>
                    </li>

                    <li class="active">
                        <a href="#">1</a>
                    </li>

                    <li>
                        <a href="#">2</a>
                    </li>

                    <li>
                        <a href="#">3</a>
                    </li>

                    <li class="next">
                        <a href="#">
                            <i class="icon-double-angle-right"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div id="modal-form" class="modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="blue bigger">Please fill the following form fields</h4>
            </div>

            <div class="modal-body overflow-visible">
                <div class="row">
                    @*<div class="col-xs-12 col-sm-5">
                        <div class="space"></div>

                        <input type="file" />
                    </div>*@

                    @*<div class="col-xs-12 col-sm-7">*@
                    <div class="col-xs-12">
                        @*<div class="form-group">
                            <label for="form-field-select-3">Location</label>

                            <div>
                                <select class="chosen-select" data-placeholder="Choose a Country...">
                                    <option value="">&nbsp;</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                </select>
                            </div>
                        </div>

                        <div class="space-4"></div>

                        <div class="form-group">
                            <label for="form-field-username">Username</label>

                            <div>
                                <input class="input-large" type="text" id="form-field-username" placeholder="Username" value="alexdoe" />
                            </div>
                        </div>

                        <div class="space-4"></div>

                        <div class="form-group">
                            <label for="form-field-first">Name</label>

                            <div>
                                <input class="input-medium" type="text" id="form-field-first" placeholder="First Name" value="Alex" />
                                <input class="input-medium" type="text" id="form-field-last" placeholder="Last Name" value="Doe" />
                            </div>
                        </div>
                        <div class="space-4"></div>*@

                        <div class="form-group">
                            <table>
                                <tr>
                                    <td>
                                        <label>开奖类型</label>
                                    </td>
                                    <td></td>
                                    <td>
                                        <label>开奖状态</label>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                </tr>
                                <tr>
                                    <td>
                                        <label>奖品名称</label>
                                    </td>
                                    <td colspan="3"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>奖品描述</label>
                                    </td>
                                    <td colspan="3"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>发布者用户名</label>
                                    </td>
                                    <td></td>
                                    <td>
                                        <label>发布者昵称</label>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                </tr>
                                <tr>
                                    <td>
                                        <label>发布者姓名</label>
                                    </td>
                                    <td></td>
                                    <td>
                                        <label>发布日期</label>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                </tr>
                            </table>
                        </div>

                        <div class="space-4"></div>
                        <div class="form-group">
                            <div style="float: left;">
                                <input class="input-medium" type="text" id="txtFuzzyUserInfo" placeholder="用户名/姓名/昵称" />
                                <input class="button" type="button" id="btnSearchUser" value="查找" />
                            </div>
                            <h3 class="icon-loading" style="float: left;display:none; width: 28px; padding: 0px; line-height: 10px; height: 28px; margin: 0px;">
                                <i class="icon-spinner icon-spin orange bigger-125"></i>
                            </h3>
                            <div class="clear"></div>
                        </div>

                        <div class="space-4"></div>
                        <div class="form-group" id="userlist-container" style="display: none;">
                            <div id="page" class="pager">
                                <table class="table table-striped table-bordered table-hover no-margin-bottom no-border-top">
                                    <thead>
                                        <tr>
                                            <th>用户名</th>
                                            <th>昵称</th>
                                            <th>电话</th>
                                            <th>Email
                                            </th>
                                            <th>操作
                                            </th>
                                        </tr>
                                    </thead>

                                    <tbody id="userTbBody"></tbody>
                                </table>
                            </div>
                            <div id="pager" class="pager">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-sm" data-dismiss="modal">
                    <i class="icon-remove"></i>
                    取消
                </button>

                <button class="btn btn-sm btn-primary">
                    <i class="icon-ok"></i>
                    保存
                </button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    @{Html.RegisterMvcPagerScriptResource();}
    <script src="~/Content/admin/assets/js/jquery.gritter.min.js"></script>
    <script src="~/Content/admin/assets/js/chosen.jquery.min.js"></script>

    <script src="~/Content/admin/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
    <script src="~/Content/admin/assets/js/jqGrid/i18n/grid.locale-en.js"></script>
    <script src="~/Scripts/jquery.pager.js"></script>
    <script type="text/javascript">
        var $path_assets = "/Content/admin/assets";
        $(function () {
            var promptOptions = {
                message: "First name:<input type='text' name='first_name'></input>",
                title: "Custom label",
                buttons: {
                    confirm: {
                        label: "Save"
                    }
                },
                callback: function (result) {
                    if (result === null) {
                        console.log("Prompt dismissed");
                    } else {
                        console.log("Hi " + result);
                    }
                }
            };
            $(".bootbox-regular").on(ace.click_event, function () {
                bootbox.prompt(promptOptions);
            });

            //$(".chosen-select").chosen();
            //$('#chosen-multiple-style').on('click', function (e) {
            //    var target = $(e.target).find('input[type=radio]');
            //    var which = parseInt(target.val());
            //    if (which == 2) $('#form-field-select-4').addClass('tag-input-style');
            //    else $('#form-field-select-4').removeClass('tag-input-style');
            //});

            /////////
            $('#modal-form input[type=file]').ace_file_input({
                style: 'well',
                btn_choose: 'Drop files here or click to choose',
                btn_change: null,
                no_icon: 'icon-cloud-upload',
                droppable: true,
                thumbnail: 'large'
            })

            //chosen plugin inside a modal will have a zero width because the select element is originally hidden
            //and its width cannot be determined.
            //so we set the width after modal is show
            $('#modal-form').on('shown.bs.modal', function () {
                $(this).find('.chosen-container').each(function () {
                    $(this).find('a:first-child').css('width', '210px');
                    $(this).find('.chosen-drop').css('width', '210px');
                    $(this).find('.chosen-search input').css('width', '200px');
                });
            })
            /**
            //or you can activate the chosen plugin after modal is shown
            //this way select element becomes visible with dimensions and chosen works as expected
            $('#modal-form').on('shown', function () {
                $(this).find('.modal-chosen').chosen();
            })
            */

            // 分页控件添加disabled样式
            $("div.paging_bootstrap a[disabled='disabled']").each(function () {
                $(this).parent().addClass("disabled");
            });

            $("a[class='intervention']").click(function () {
                initUiBeforeSearchUsers();
                $("h3.icon-loading").hide();
                var $row = $(this).parent().parent();
                var rt = $row.find("td").eq(0).html();
                var rs = $row.find("td").eq(1).html();
                var pnamehtml = $row.find("td").eq(2).html();
                var pname = $(pnamehtml).html();
                var pdeshtml = $row.find("td").eq(3).html();
                var pdes = $(pnamehtml).html();
                var uname = $row.find("td").eq(4).html();
                var publisher = $row.find("td").eq(5).html();
                var publishdate = $row.find("td").eq(6).html();
                console.log(rt)
                console.log(rs)
                console.log(pname)
                console.log(pdes)
                console.log(uname)
                console.log(publisher)
                console.log(publishdate)
            });

            $("#btnSearchUser").click(function () {
                //GeneratePager();
                GetListData(1, true);
            });
        });

        function initUiBeforeSearchUsers() {
            $('#userTbBody>tr').remove();
            $("#userlist-container").hide();
        }

        //处理时间
        function deleteString(mainStr) {
            raRegExp = new RegExp("[^\\d]", "g");
            mainStr = mainStr.replace(raRegExp, "");
            return mainStr.substr(0, mainStr.length - 4);
        }

        //获取数据
        function GetListData(pageclickednumber, pager) {
            var pageclickednumber = arguments[0] ? arguments[0] : 1;
            var pager = arguments[1] ? arguments[1] : false;
            $.ajax({
                type: 'POST',
                url: '../Account/li',
                cache: false,
                data: {
                    pagenumber: pageclickednumber,
                    kword: $("#txtFuzzyUserInfo").val()
                },
                success: function (data) {
                    if (data == null)
                        return;
                    var pagecount = data.PageCount;
                    if (pager) {
                        GeneratePager(pagecount);
                    }
                    data = eval(data.Data);
                    $.each(data, function (i) {
                        var d = new Date(Number(deleteString(data[i].AddDate)));
                        data[i].AddDate = d.toLocaleDateString() + d.toLocaleTimeString();
                        $('#userTbBody').append(
                        "<tr>" +
                            "<td>" + data[i].UserName + "</td>" +
                            "<td>" + data[i].Name + "</td>" +
                        "<td>" + data[i].Tel + "</td>" +
                        "<td>" + data[i].Email + "</td>" +
                        "<td><a href=\"#\">加入白名单</a></td>" +
                        "</tr>"
                        );
                    });
                },
                beforeSend: function () {
                    $("h3.icon-loading").show();
                    initUiBeforeSearchUsers();
                },
                complete: function () {
                    $("#userlist-container").show();
                    $("h3.icon-loading").hide();
                },
                dataType: "json"
            });
        };

        //生成ajax分页控件
        function GeneratePager(pagecount) {
            //创建一个函数,其中pagedata[0].count是后台可以分到的页数
            PageClick = function (pageclickednumber) {
                $("#pager").pager({ pagenumber: pageclickednumber, pagecount: pagecount, buttonClickCallback: PageClick });
                GetListData(pageclickednumber);
            };
            //创建分页工具栏,其中pagedata[0].count是后台可以分到的页数
            $("#pager").pager({ pagenumber: 1, pagecount: pagecount, buttonClickCallback: PageClick });
        }
    </script>
}